<!-- Delete Confirmation Modal -->
<div
  id="deleteModal"
  class="hidden fixed inset-0 z-50 w-full flex items-center justify-center bg-gray-800 bg-opacity-50"
>
  <div
    id="deleteModalContent"
    class="bg-white rounded-lg shadow-lg w-11/12 sm:w-1/2 lg:w-1/3 max-h-screen overflow-y-auto p-6"
  >
    <!-- Modal header -->
    <div class="flex items-center justify-between border-b pb-3">
      <h3 class="text-xl font-semibold text-gray-900">Delete Product</h3>
      <button
        type="button"
        class="text-gray-400 hover:text-gray-700"
        onclick="hideDeleteModal()"
      >
        âœ•
      </button>
    </div>

    <!-- Modal body -->
    <div class="py-6 text-center">
      <p class="text-gray-700 text-base mb-4">
        Are you sure you want to delete this product?
      </p>
      <p id="deleteProductName" class="text-lg font-semibold text-red-500"></p>
    </div>

    <!-- Modal footer -->
    <div class="flex justify-end gap-3 border-t pt-4">
      <button
        type="button"
        onclick="hideDeleteModal()"
        class="px-5 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-100 transition-all"
      >
        Cancel
      </button>
      <button
        type="button"
        id="confirmDeleteButton"
        class="px-5 py-2 bg-gradient-to-r from-blue-400 to-red-400 text-white rounded-md font-medium hover:brightness-90 transition-all"
      >
        Delete
      </button>
    </div>
  </div>
</div>

<script>
  let productIdToDelete = null;

  function showDeleteModal(productId, productName) {
    productIdToDelete = productId;
    document.getElementById("deleteProductName").textContent =
      DOMPurify.sanitize(productName);
    const modal = document.getElementById("deleteModal");
    const modalContent = document.getElementById("deleteModalContent");

    modal.classList.remove("hidden");
    setTimeout(() => {
      modalContent.classList.remove("opacity-0", "scale-95");
      modalContent.classList.add("opacity-100", "scale-100");
    }, 50);
  }

  function hideDeleteModal() {
    const modal = document.getElementById("deleteModal");
    const modalContent = document.getElementById("deleteModalContent");

    modalContent.classList.remove("opacity-100", "scale-100");
    modalContent.classList.add("opacity-0", "scale-95");

    setTimeout(() => {
      modal.classList.add("hidden");
    }, 150);
  }

  document
    .getElementById("confirmDeleteButton")
    .addEventListener("click", async () => {
      if (!productIdToDelete) return;

      try {
        const response = await fetch(`/product/${productIdToDelete}/delete/`, {
          method: "DELETE",
          headers: { "X-CSRFToken": getCookie("csrftoken") },
        });

        if (response.ok) {
          showToast("Product deleted successfully!", "", "success");
          hideDeleteModal();
          document.dispatchEvent(new CustomEvent("productDeleted"));
          window.location.href = "";
        } else {
          const data = await response.json();
          showToast(
            `Error: ${data.error || "Failed to delete product"}`,
            "",
            "error"
          );
        }
      } catch (error) {
        showToast("Failed to connect to server", "", "error");
      }
    });

  // Utility: ambil CSRF token dari cookie
  function getCookie(name) {
    const cookieValue = document.cookie
      .split("; ")
      .find((row) => row.startsWith(name + "="))
      ?.split("=")[1];
    return cookieValue ? decodeURIComponent(cookieValue) : null;
  }
</script>
