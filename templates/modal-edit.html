<!-- Edit Modal -->
<div
  id="editModal"
  class="hidden fixed inset-0 z-50 w-full flex items-center justify-center bg-gray-800 bg-opacity-50"
>
  <div
    id="editModalContent"
    class="bg-white rounded-lg shadow-lg w-5/6 sm:w-3/5 md:w-1/2 lg:w-2/5 xl:w-1/3 max-h-screen overflow-y-auto transition-all duration-150 opacity-0 scale-95"
  >
    <!-- Modal header -->
    <div class="flex items-center justify-between p-4 border-b">
      <div>
        <h3 class="text-xl font-semibold text-gray-900">Edit Product</h3>
        <p class="text-sm text-gray-600 mt-1">Update your product details</p>
      </div>
      <button
        type="button"
        class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center"
        onclick="hideEditModal()"
      >
        <svg
          aria-hidden="true"
          class="w-5 h-5"
          fill="currentColor"
          viewBox="0 0 20 20"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            fill-rule="evenodd"
            d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
            clip-rule="evenodd"
          ></path>
        </svg>
      </button>
    </div>

    <!-- Modal body -->
    <div class="px-6 py-4 space-y-4 form-style">
      <form id="editProductForm">
        <input type="hidden" id="editProductId" name="id" />
        <div class="mb-4">
          <label for="editName" class="block text-sm font-medium text-gray-700"
            >Name</label
          >
          <input
            type="text"
            id="editName"
            name="name"
            class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"
            required
          />
        </div>
        <div class="mb-4">
          <label for="editPrice" class="block text-sm font-medium text-gray-700"
            >Price</label
          >
          <input
            type="number"
            id="editPrice"
            name="price"
            class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"
            required
          />
        </div>
        <div class="mb-4">
          <label
            for="editDescription"
            class="block text-sm font-medium text-gray-700"
            >Description</label
          >
          <textarea
            id="editDescription"
            name="description"
            rows="3"
            class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"
            required
          ></textarea>
        </div>
        <div class="mb-4">
          <label
            for="editCategory"
            class="block text-sm font-medium text-gray-700"
            >Category</label
          >
          <select
            id="editCategory"
            name="category"
            class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"
            required
          >
            <option value="boots">Boots</option>
            <option value="jersey">Jersey</option>
            <option value="ball">Ball</option>
            <option value="other">Other</option>
          </select>
        </div>
        <div class="mb-4">
          <label
            for="editThumbnail"
            class="block text-sm font-medium text-gray-700"
            >Thumbnail URL</label
          >
          <input
            type="url"
            id="editThumbnail"
            name="thumbnail"
            class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"
          />
        </div>
        <div class="mb-4">
          <div class="flex items-center">
            <input
              id="editIsFeatured"
              name="is_featured"
              type="checkbox"
              class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded"
            />
            <label
              for="editIsFeatured"
              class="ml-2 text-sm font-medium text-gray-900"
              >Featured Product</label
            >
          </div>
        </div>
      </form>
    </div>

    <!-- Modal footer -->
    <div
      class="flex flex-col sm:flex-row gap-4 p-6 border-t border-gray-200 rounded-b"
    >
      <button
        type="button"
        class="order-2 sm:order-1 px-6 py-3 border border-gray-300 text-gray-700 rounded-md font-medium hover:bg-gray-50 transition-colors text-center"
        onclick="hideEditModal()"
      >
        Cancel
      </button>
      <button
        type="submit"
        id="submitEditProduct"
        form="editProductForm"
        class="order-1 sm:order-2 flex-1 bg-gradient-to-r from-blue-400 to-red-400 text-white px-6 py-3 rounded-md font-medium hover:brightness-90 transition-all"
      >
        Save Changes
      </button>
    </div>
  </div>
</div>

<script>
  function showEditModal(
    id,
    name,
    price,
    description,
    category,
    thumbnail = "",
    is_featured
  ) {
    // Fill the form with existing data
    document.getElementById("editProductId").value = id;
    document.getElementById("editName").value = name;
    document.getElementById("editPrice").value = price;
    document.getElementById("editDescription").value = description;
    document.getElementById("editCategory").value = category;
    document.getElementById("editThumbnail").value = thumbnail;
    document.getElementById("editIsFeatured").checked = is_featured;

    // Show modal
    const modal = document.getElementById("editModal");
    const modalContent = document.getElementById("editModalContent");

    modal.classList.remove("hidden");
    setTimeout(() => {
      modalContent.classList.remove("opacity-0", "scale-95");
      modalContent.classList.add("opacity-100", "scale-100");
    }, 50);
  }

  function hideEditModal() {
    const modal = document.getElementById("editModal");
    const modalContent = document.getElementById("editModalContent");

    modalContent.classList.remove("opacity-100", "scale-100");
    modalContent.classList.add("opacity-0", "scale-95");

    setTimeout(() => {
      modal.classList.add("hidden");
    }, 150);
  }

  async function editProductEntry() {
    const form = document.getElementById("editProductForm");
    const id = document.getElementById("editProductId").value;

    await fetch(`/edit-product-ajax/${id}/`, {
      method: "POST",
      body: new FormData(form),
    });

    form.reset();
    hideEditModal();
    showToast("Product updated successfully!", "", "success");

    // Dispatch event for refreshing list
    document.dispatchEvent(new CustomEvent("productUpdated"));
    window.location.href = "";
    return false;
  }

  document
    .getElementById("editProductForm")
    .addEventListener("submit", function (e) {
      e.preventDefault();
      editProductEntry();
    });
</script>
